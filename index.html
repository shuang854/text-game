<!doctype html>
<html>

<head>
    <title>Txtvrse</title>
    <link rel="stylesheet" href="https://rawgit.com/shuang854/txtvrse/dev/css/interface.css">

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
</head>

<body>
    <div id="intro">
        <p id="title">Txtvrse</p> 
        <p id="u">Username:</p>
        <p id="error"><br></p>
        <form id="user" action="">
            <input id="username" autocomplete="off" placeholder="USERNAME" autofocus maxlength="8" /><button id="sub">Submit</button>
        </form>
    </div>

    <div id="game">
        <ul id="messages"></ul>
        <form id="prompt" action="">
            <input id="m" autocomplete="off" /><button id="send">Send</button>
        </form>
    </div>
</body>
<script>
    var socket = io()
    
    // LOGIN
    
    $("#game").hide()
    
    $("#user").submit(() => {
        var nameInput = $("#username").val() // get name
        socket.emit("register", { "name": nameInput }) // attempt registration
        return false // don't refresh page
    })
    
    socket.on("registered", () => { // upon registration success
        $("#game").show() // show the game UI
        $("#intro").hide() // hide the intro UI
    })
    
    socket.on("rejected", (data) => { // upon registration failure
        $("#error").text(data.reason) // show reason
    })
    
    // MESSAGING
    
    // Sending
    $("#prompt").submit(() => {
        socket.emit("command", { "message": $("#m").val() })
        $("#m").val("")
        // TODO: add functionality for up button to look at command history
        return false // don't refresh page
    })
    
    // Handling response
    
    socket.on("notification", (data) => {
        $("#messages").append($("<li>").text(data.message));
        $("#messages").scrollTop($("#messages").prop("scrollHeight")); // auto scroll
    })
</script>

</html>
